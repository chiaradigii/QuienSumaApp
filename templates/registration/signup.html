<!-- signup.html -->
{% extends "base/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block titulo %}Signup{% endblock titulo %}

{% block head %}
<link rel="stylesheet"
href=
"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
<!-- Tempus Dominus Bootstrap 4 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/css/tempusdominus-bootstrap-4.min.css" integrity="sha256-XPTBwC3SBoWHSmKasAk01c08M6sIA5gF5+sRxqak2Qs=" crossorigin="anonymous" />
<style>
form i {
        margin-left: -30px;
        cursor: pointer;
    }
.password-field {
        position: relative;
}
.password-toggle {
        color: #FFFDD0;
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        font-size: 24px;
    }
.form-outline .form-control {
        padding-right: 2.5rem; 
        line-height: 24px;
        
    }
.card {
    background-color: rgba(0, 0, 0, 0.7);
    color: #FFFDD0;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.gradient-custom {
    background-image: url('{% static "/img/carrousel3.jpg" %}');
    background-size: cover; 
    background-position: center; 
    background-repeat: no-repeat; 
}
.card-registration  {
    max-width: 1000px;
    margin: 0 auto;
    }

.card-registration .card-body {
        padding: 2rem; 
    }

.card-registration .select-input.form-control[readonly]:not([disabled]) {
        font-size: 1rem;
        line-height: 2.15;
        padding-left: .75em;
        padding-right: .75em;
        }
.card-registration .select-arrow {
        top: 13px;
    }
    .form-outline {
        margin-bottom: 0.5rem; 
    }

    .mb-2 {
        margin-bottom: 0.5rem; 
    }
    .form-outline .form-control {
        padding: 0.5rem 1rem; 
    }
    .vh-100 {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .card-body {
        padding: 1rem 1rem;
    }
    .card-registration {
        max-height:  calc(100vh - 40px); 
        overflow-y: auto; 
    }
    h3.mb-3 {
        font-size: 2.2rem; /
        font-weight: bold; 
        font-family: 'Montserrat', sans-serif;
    }
    
    ::placeholder {
        color: #FFFDD0;
        opacity: 1; 
    }
    .container.py-5.h-100 {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        padding-top: 0;
        padding-bottom: 0;
    }
    .btn-warning {
        background-color: #006666;
        border: none;
        color: #FFFDD0;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
        font-family: 'Montserrat', sans-serif;
    }

    .btn-warning:hover {
        background-color: #339999;
        color: #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

</style>
{% endblock head %}

{% block body %}
<section class="vh-100 gradient-custom">
    <div class="container">
                <div class="card shadow-2-strong card-registration" style="border-radius: 15px"> 
                    <div class="card-body p-4 p-md-5">
                        <h3 class="mb-3 pb-2 pb-md-0 mb-md-4 text-uppercase">Sign Up</h3>
                            <form id="signupForm" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}   
                            <div class="row">
                                <div class="col">         
                                    <div class="form-outline">          
                                        {{ form.user|as_crispy_field }}
                                    </div>
                                </div>
                                
                                <div class="col">   
                                    <div class="form-outline">          
                                         {{form.correo|as_crispy_field}}
                                    </div>  
                                </div>
                            <div class="row">
                            <div class="col">
                                <div class="form-outline">              
                                        {{form.nombre|as_crispy_field}} 
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-outline"> 
                                    {{form.apellido|as_crispy_field}}
                                </div>   
                            </div>
                            </div>
                            <div class="row"> 
                                <div class="col">  
                                    <div class="form-outline">             
                                    <h6 class="mb-0 me-4">Sexo: </h6>
                                    {{ form.sexo }}

                                    </div>                                  
                                </div>
                                
                                <div class="col">
                                    <div class="form-outline mb-4" style="position: relative;">
                                        {{ form.fecha_nacimiento|as_crispy_field }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                    <div class="col">
                                        {{form.direccion|as_crispy_field}}
                                    </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-outline">
                                        {{form.posicion|as_crispy_field}}
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-outline">
                                        {{form.foto|as_crispy_field}}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-outline password-field">
                                        <label>Contraseña</label>
                                        <input type="password" name="{{ form.password1.name }}" id="id_password1" class="form-control" required>
                                        <i class="bi bi-eye-slash password-toggle" id="togglePassword1"></i>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-outline password-field">
                                        <label>Confirmar contraseña</label>
                                        <input type="password" name="{{ form.password2.name }}" id="id_password2" class="form-control" required>
                                        <i class="bi bi-eye-slash password-toggle" id="togglePassword2"></i>
                                    </div>
                                </div>
                            </div>
                                        
                                        <div class="d-flex justify-content-center-end pt-3">
                                            <button type="submit" id="confirmarButton" class="btn btn-warning btn-lg ms-2" data-bs-toggle="modal" data-bs-target="#registroExitosoModal">Confirmar</button>
                                        </div>
                                    </form>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

  <!-- Modal HTML -->
  <div class="modal fade" id="registroExitosoModal" tabindex="-1" aria-labelledby="registroExitosoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registroExitosoModalLabel" style="color: black;">Registro Exitoso</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="color: black;">
                Tu registro se ha completado correctamente.
            </div>
            <div class="modal-footer">
                <a class="btn btn-secondary" href="{% url 'main_app:home' %}">Cerrar</a>
                <a class="btn btn-secondary" href="{% url 'jugador_app:login' %}">Iniciar Sesión</a>
            </div>
        </div>
    </div>
</div>

</section>


{% endblock body %}

{% block scripts %}
{{ block.super }}

<!-- script for Google Maps API -->
<script>
    console.log('Google Maps API Key:', '{{ google_maps_api_key }}');
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places&callback=initAutocomplete" async defer></script>

<script>
    $(document).ready(function() {
        $('#signupForm').on('submit', function(e) {
            e.preventDefault();

            $.ajax({
                type: 'POST',
                url: window.location.href,
                data: new FormData(this),
                contentType: false,
                processData: false,
                success: function(response) {
                    if (response.status === 'success') {
                        $('#registroExitosoModal').modal('show');
                    } else {
                        console.log(response.errors);
                    }
                },
                error: function(response) {
                    alert('Error: ' + response.responseJSON.message);
                }
            });
        });
    });
</script>
<!-- Script for the autocompletion function -->
<script>
    function initAutocomplete() {
        console.log('initAutocomplete called');
        var input = document.getElementById('id_direccion');
        if (input && input.tagName === 'INPUT') {
            console.log('Initializing Google Places Autocomplete');
            var autocomplete = new google.maps.places.Autocomplete(input);
        } else {
            console.error('El input de autocompletado no se encuentra en el DOM o no es un elemento input válido');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded and parsed');
        if (typeof google !== 'undefined') {
            initAutocomplete();
        } else {
            console.error('Google Maps JavaScript API not loaded');
        }
    });
</script>
<!-- Other scripts -->
<script type="text/javascript">
    $(function () {
        $('#id_fecha_nacimiento').datetimepicker({
            format: 'DD-MM-YYYY'  
        });
    });
</script>
<script>
    const togglePassword1 = document.querySelector('#togglePassword1');
    const password1 = document.querySelector('#id_password1');
    togglePassword1.addEventListener('click', function() {
        const type = password1.getAttribute('type') === 'password' ? 'text' : 'password';
        password1.setAttribute('type', type);
        this.classList.toggle('bi-eye');
    });

    const togglePassword2 = document.querySelector('#togglePassword2');
    const password2 = document.querySelector('#id_password2');
    togglePassword2.addEventListener('click', function() {
        const type = password2.getAttribute('type') === 'password' ? 'text' : 'password';
        password2.setAttribute('type', type);
        this.classList.toggle('bi-eye');
    });
</>

{% endblock scripts %}